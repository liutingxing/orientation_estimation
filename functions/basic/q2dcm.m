function [cbn] = q2dcm (q)

cbn = zeros(3,3);

cbn(1, 1) = q(1)*q(1) + q(2)*q(2) - q(3)*q(3) - q(4)*q(4);
cbn(1, 2) = 2 * (q(2)*q(3) - q(1)*q(4));
cbn(1, 3) = 2 * (q(2)*q(4) + q(1)*q(3));

cbn(2, 1) = 2 * (q(2)*q(3) + q(1)*q(4));
cbn(2, 2) = q(1)*q(1) - q(2)*q(2) + q(3)*q(3) - q(4)*q(4);
cbn(2, 3) = 2 * (q(3)*q(4) - q(1)*q(2));

cbn(3, 1) = 2 * (q(2)*q(4) - q(1)*q(3));
cbn(3, 2) = 2 * (q(3)*q(4) + q(1)*q(2));
cbn(3, 3) = q(1)*q(1) - q(2)*q(2) - q(3)*q(3) + q(4)*q(4);